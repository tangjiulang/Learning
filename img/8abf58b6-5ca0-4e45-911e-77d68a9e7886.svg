<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="793px" height="603px" viewBox="-0.5 -0.5 793 603"><defs/><g><path d="M 326 286 L 396 286 L 396 46 L 459.63 46" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 464.88 46 L 457.88 49.5 L 459.63 46 L 457.88 42.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 326 286 L 396 286 L 396 136 L 459.63 136" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 464.88 136 L 457.88 139.5 L 459.63 136 L 457.88 132.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="16" y="256" width="310" height="60" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 308px; height: 1px; padding-top: 286px; margin-left: 17px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div style="background-color: rgb(255, 255, 255); font-family: Menlo, Monaco, &quot;Courier New&quot;, monospace; font-size: 16px; line-height: 24px;"><span style="color: #267f99;">DBImpl</span>::<span style="color: #795e26;">MakeRoomForWrite</span></div></div></div></div></foreignObject></g><rect x="466" y="16" width="310" height="60" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 308px; height: 1px; padding-top: 46px; margin-left: 467px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div style="background-color: rgb(255, 255, 255); font-family: Menlo, Monaco, &quot;Courier New&quot;, monospace; font-size: 16px; line-height: 24px;"><font color="#267f99">1.有错误的话，直接退出</font></div></div></div></div></foreignObject></g><rect x="466" y="106" width="310" height="60" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 308px; height: 1px; padding-top: 136px; margin-left: 467px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div style="background-color: rgb(255, 255, 255); font-family: Menlo, Monaco, &quot;Courier New&quot;, monospace; font-size: 16px; line-height: 24px;"><font color="#267f99">2.</font><span style="color: rgb(0, 128, 0);">如果允许延迟，而且文件个数没有超过硬限制，那么可以等1s.但是只能等1次</span></div></div></div></div></foreignObject></g><rect x="466" y="196" width="310" height="60" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 308px; height: 1px; padding-top: 226px; margin-left: 467px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div style="background-color: rgb(255, 255, 255); font-family: Menlo, Monaco, &quot;Courier New&quot;, monospace; font-size: 16px; line-height: 24px;"><font color="#267f99">3.</font><span style="color: rgb(0, 128, 0);">如果不能延迟，而且mem又有充足的空间，那么也不需要进行处理，直接退出循环</span></div></div></div></div></foreignObject></g><rect x="466" y="296" width="310" height="60" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 308px; height: 1px; padding-top: 326px; margin-left: 467px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div style="background-color: rgb(255, 255, 255); font-family: Menlo, Monaco, &quot;Courier New&quot;, monospace; font-size: 16px; line-height: 24px;"><font color="#267f99">4.</font><span style="color: rgb(0, 128, 0);">如果已经有一个minior 压缩的线程了，此时就不能在启一个了</span></div></div></div></div></foreignObject></g><rect x="466" y="386" width="310" height="60" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 308px; height: 1px; padding-top: 416px; margin-left: 467px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div style="background-color: rgb(255, 255, 255); font-family: Menlo, Monaco, &quot;Courier New&quot;, monospace; font-size: 16px; line-height: 24px;"><font color="#267f99">5.</font><span style="color: rgb(0, 128, 0);">如果第0层文件超过了硬限制，此时需要停止写了。等待着被唤醒</span></div></div></div></div></foreignObject></g><rect x="466" y="476" width="310" height="110" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 308px; height: 1px; padding-top: 531px; margin-left: 467px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div style="background-color: rgb(255, 255, 255); font-family: Menlo, Monaco, &quot;Courier New&quot;, monospace; font-size: 16px; line-height: 24px;"><font color="#267f99">6.</font><span style="color: rgb(0, 128, 0);">否则就需要创建新的mem，开始minior 压缩，调用</span><span style="color: rgb(121, 94, 38);">MaybeScheduleCompaction</span></div></div></div></div></foreignObject></g><path d="M 326 286 L 396 286 L 396 531 L 459.63 531" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 464.88 531 L 457.88 534.5 L 459.63 531 L 457.88 527.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 326 286 L 396 286 L 396 416 L 459.63 416" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 464.88 416 L 457.88 419.5 L 459.63 416 L 457.88 412.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 326 286 L 396 286 L 396 326 L 459.63 326" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 464.88 326 L 457.88 329.5 L 459.63 326 L 457.88 322.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 326 286 L 396 286 L 396 226 L 459.63 226" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 464.88 226 L 457.88 229.5 L 459.63 226 L 457.88 222.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/></g></svg>